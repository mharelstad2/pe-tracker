<!DOCTYPE html>
<html lang="en">
  <head>
    <title>PE Tracker</title>
    <meta charset="UTF-8">
    <style>
      /* Added CSS styles here */
      body {
        font-family: Arial, sans-serif;
        background-color: #f2f2f2;
      }

      h1 {
        color: #333;
      }

      button {
        padding: 10px 20px;
        background-color: #007bff;
        color: #fff;
        border: none;
        cursor: pointer;
        margin: 5px;
      }

      button:hover {
        background-color: #0056b3;
      }

      button#praiseButton {
        background-color: #4caf50;
      }

      button#criticizeButton {
        background-color: #ff5722;
      }

      #output {
        margin: 10px;
      }
    </style>
  </head>
  <body>
    <h1>Hello World!</h1>
    <% buttons.forEach(function(b) { %>
      <button id="behavior-<%= b.id %>" onclick="send('<%= b.id %>');">
        <%= b.name %>
      </button>
    <% }); %>
    <p id="output"></p>
    <h1>Observer App</h1>
    <button id="praiseButton" onclick="incrementCount('praise')">Praise</button>
    <button id="criticizeButton" onclick="incrementCount('criticize')">Criticize</button>
    <button id="resetButton" onclick="resetCounts()">Reset Counts</button>
    <p>Praise Count: <span id="praiseCount">0</span></p>
    <p>Criticize Count: <span id="criticizeCount">0</span></p>

    <script>
      // JavaScript functions for counting behavior
      let praiseCount = 0;
      let criticizeCount = 0;

      function incrementCount(type) {
        if (type === 'praise') {
          praiseCount++;
          document.getElementById('praiseCount').textContent = praiseCount;
        } else if (type === 'criticize') {
          criticizeCount++;
          document.getElementById('criticizeCount').textContent = criticizeCount;
        }
      }

      function resetCounts() {
        praiseCount = 0;
        criticizeCount = 0;
        document.getElementById('praiseCount').textContent = praiseCount;
        document.getElementById('criticizeCount').textContent = criticizeCount;
      }
    </script>

    <script>
      // JavaScript functions to handle button clicks and count updates
      let buttonClicked = false; // Add this variable to track button clicks
      let behaviorCounts = {};

      async function send(id) {
        if (!buttonClicked) {
          buttonClicked = true; // Set the flag to prevent further clicks

          const response = await fetch("/log", {
            method: "POST",
            headers: {
              "Accept": "application/json",
              "Content-Type": "application/json",
            },
            body: JSON.stringify({
              id: id,
            }),
          });
          const result = await response.json();
          if (result.error) {
            document.getElementById("output").innerHTML = `<strong>ERROR: ${result.error.routine}`;
          } else {
            const behaviorId = result.newId.new_id;
            const currentTime = result.when.localtime;
            behaviorCounts[behaviorId] = (behaviorCounts[behaviorId] || 0) + 1;
            updateBehaviorCountsUI();
          }
        }
      }

      function updateBehaviorCountsUI() {
        for (const behaviorId in behaviorCounts) {
          if (behaviorCounts.hasOwnProperty(behaviorId)) {
            const count = behaviorCounts[behaviorId];
            document.getElementById(`count-${behaviorId}`).textContent = count;
          }
        }
      }
    </script>
  </body>
</html>



